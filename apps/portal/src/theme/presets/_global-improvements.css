/**
 * Global Visual Improvements
 * ===========================
 * Cross-theme improvements for consistency, accessibility, and visual polish
 * Applied to all themes unless specifically overridden
 */

/* ============================================
   IMPROVED FOCUS RINGS
   ============================================ */
/* Note: Removed global *:focus rules to prevent conflicts with MUI.
   Focus styles are handled by component-specific CSS. */

/* Better focus for interactive elements */
button:focus-visible,
a:focus-visible,
input:focus-visible,
textarea:focus-visible,
select:focus-visible,
[role="button"]:focus-visible,
[role="link"]:focus-visible,
[tabindex]:focus-visible {
  outline: var(--cmp-input-focus-ring-width, 2px) solid var(--cmp-input-focus-ring-color, var(--sys-interactive-accent));
  outline-offset: var(--cmp-input-focus-ring-offset, 2px);
}

/* ============================================
   IMPROVED DISABLED STATES
   ============================================ */
/* Note: Removed global disabled button styles to prevent conflicts.
   Disabled styles are handled by component libraries (MUI). */

/* ============================================
   IMPROVED CARD SHADOWS & DEPTH
   ============================================ */
.ui-card,
[data-ui="card"] {
  box-shadow: var(--cmp-card-shadow);
  transition:
    box-shadow var(--theme-motion-medium, 280ms) var(--theme-motion-easing, ease),
    transform var(--theme-motion-medium, 280ms) var(--theme-motion-easing, ease),
    border-color var(--theme-motion-fast, 180ms) ease;
}

.ui-card:hover,
[data-ui="card"]:hover {
  transform: translateY(var(--theme-motion-card-lift, -2px));
}

/* ============================================
   IMPROVED BUTTON CONSISTENCY
   ============================================ */
.ui-button,
[data-ui="button"],
button.control {
  position: relative;
  transition:
    background-color var(--theme-motion-fast, 180ms) ease,
    border-color var(--theme-motion-fast, 180ms) ease,
    box-shadow var(--theme-motion-fast, 180ms) ease,
    transform var(--theme-motion-fast, 180ms) ease;
}

.ui-button:active:not(:disabled),
[data-ui="button"]:active:not(:disabled),
button.control:active:not(:disabled) {
  transform:
    translateY(var(--theme-motion-press-y, 1px))
    scale(var(--theme-motion-press-scale, 0.98));
}

/* Consistent icon button hit area and sizing */
.MuiIconButton-root,
[data-ui="icon-button"] {
  width: 2.375rem;
  height: 2.375rem;
  min-width: 2.375rem;
  min-height: 2.375rem;
}

/* ============================================
   IMPROVED INPUT FIELD STATES
   ============================================ */
input:not([type="checkbox"]):not([type="radio"]),
textarea,
select {
  transition:
    border-color var(--theme-motion-fast, 180ms) ease,
    box-shadow var(--theme-motion-fast, 180ms) ease,
    background-color var(--theme-motion-fast, 180ms) ease;
}

input:not([type="checkbox"]):not([type="radio"]):hover:not(:disabled):not(:focus),
textarea:hover:not(:disabled):not(:focus),
select:hover:not(:disabled):not(:focus) {
  border-color: var(--cmp-input-hover-border);
}

input:not([type="checkbox"]):not([type="radio"]):focus,
textarea:focus,
select:focus {
  border-color: var(--cmp-input-focus-border);
  box-shadow: 0 0 0 3px color-mix(in srgb, var(--cmp-input-focus-border) 20%, transparent);
}

/* Better placeholder visibility */
::placeholder {
  color: var(--cmp-input-placeholder);
  opacity: 1;
}

/* ============================================
   IMPROVED ACTIVE NAV INDICATORS
   ============================================ */
[data-active="true"],
[aria-current="page"],
.active {
  position: relative;
}

/* Add visual indicator for active nav items */
[data-active="true"]::before,
[aria-current="page"]::before,
.active::before {
  content: "";
  position: absolute;
  left: 0;
  top: 50%;
  transform: translateY(-50%);
  width: 4px;
  height: 60%;
  background: var(--sys-interactive-accent);
  border-radius: 0 2px 2px 0;
  box-shadow: 0 0 10px color-mix(in srgb, var(--sys-interactive-accent) 28%, transparent);
}

/* Horizontal nav indicator (bottom navigation) */
.bottom-nav [data-active="true"]::before,
.bottom-nav [aria-current="page"]::before,
.bottom-nav .active::before,
.horizontal-nav [data-active="true"]::before,
.horizontal-nav [aria-current="page"]::before,
.horizontal-nav .active::before {
  left: 50%;
  top: auto;
  bottom: 0;
  transform: translateX(-50%);
  width: 60%;
  height: 3px;
  border-radius: 2px 2px 0 0;
}

/* ============================================
   IMPROVED TAB ACTIVE STATES
   ============================================ */
[role="tab"][aria-selected="true"] {
  position: relative;
  color: var(--cmp-tab-active-text);
  font-weight: 600;
}

[role="tab"][aria-selected="true"]::after {
  content: "";
  position: absolute;
  bottom: 0;
  left: 0;
  right: 0;
  height: var(--cmp-tab-active-border-width, 2px);
  background: var(--cmp-tab-active-border);
  border-radius: 2px 2px 0 0;
}

/* ============================================
   IMPROVED VALIDATION STATES
   ============================================ */
input:invalid:not(:placeholder-shown),
textarea:invalid:not(:placeholder-shown),
select:invalid:not(:placeholder-shown),
[aria-invalid="true"] {
  border-color: var(--color-status-error);
}

input:invalid:not(:placeholder-shown):focus,
textarea:invalid:not(:placeholder-shown):focus,
select:invalid:not(:placeholder-shown):focus,
[aria-invalid="true"]:focus {
  box-shadow: 0 0 0 3px color-mix(in srgb, var(--color-status-error) 20%, transparent);
}

input:valid:not(:placeholder-shown),
textarea:valid:not(:placeholder-shown),
select:valid:not(:placeholder-shown) {
  border-color: var(--color-status-success);
}

/* ============================================
   IMPROVED SCROLLBAR STYLING
   ============================================ */
* {
  scrollbar-width: thin;
  scrollbar-color: var(--sys-border-strong) transparent;
}

*::-webkit-scrollbar {
  width: 8px;
  height: 8px;
}

*::-webkit-scrollbar-track {
  background: transparent;
}

*::-webkit-scrollbar-thumb {
  background: var(--sys-border-strong);
  border-radius: 4px;
  border: 2px solid transparent;
  background-clip: padding-box;
}

*::-webkit-scrollbar-thumb:hover {
  background: var(--sys-border-default);
  border: 2px solid transparent;
  background-clip: padding-box;
}

/* ============================================
   IMPROVED SELECTION HIGHLIGHTING
   ============================================ */
::selection {
  background: color-mix(in srgb, var(--sys-interactive-accent) 30%, transparent);
  color: var(--sys-text-primary);
}

::-moz-selection {
  background: color-mix(in srgb, var(--sys-interactive-accent) 30%, transparent);
  color: var(--sys-text-primary);
}

/* ============================================
   IMPROVED SKELETON LOADING STATES
   ============================================ */
.skeleton,
[data-loading="true"] {
  background: linear-gradient(
    90deg,
    var(--sys-surface-elevated) 0%,
    color-mix(in srgb, var(--sys-surface-elevated) 95%, white) 50%,
    var(--sys-surface-elevated) 100%
  );
  background-size: 200% 100%;
  animation: skeleton-loading 1.5s ease-in-out infinite;
  border-radius: var(--cmp-card-radius);
}

@keyframes skeleton-loading {
  0% {
    background-position: 200% 0;
  }
  100% {
    background-position: -200% 0;
  }
}

/* ============================================
   IMPROVED TOOLTIP POSITIONING
   ============================================ */
[data-tooltip],
[aria-describedby] {
  position: relative;
}

/* ============================================
   IMPROVED MICRO-INTERACTIONS
   ============================================ */
/* Ripple effect container */
.ripple-container {
  position: relative;
  overflow: hidden;
}

/* Subtle hover lift for interactive cards */
.interactive-card:hover {
  transform: translateY(-2px);
  transition: transform 200ms ease;
}

/* Icon rotation on hover */
.rotating-icon:hover {
  transform: rotate(90deg);
  transition: transform 300ms cubic-bezier(0.34, 1.56, 0.64, 1);
}

/* ============================================
   APP SHELL ATMOSPHERE + ROUTE SURFACES
   ============================================ */
.app-shell {
  isolation: isolate;
  background:
    var(--app-shell-ambient,
      radial-gradient(1200px circle at 4% -10%, color-mix(in srgb, var(--sys-interactive-accent) 9%, transparent) 0%, transparent 56%),
      radial-gradient(1000px circle at 100% 0%, color-mix(in srgb, var(--sys-border-strong) 10%, transparent) 0%, transparent 60%)),
    var(--sys-surface-page);
}

.app-shell::before {
  content: "";
  position: fixed;
  inset: 0;
  pointer-events: none;
  z-index: -2;
  opacity: var(--app-shell-overlay-opacity, 0.38);
  background: var(--app-shell-overlay, linear-gradient(180deg, color-mix(in srgb, var(--sys-surface-page) 88%, transparent), transparent 28%));
}

.app-shell::after {
  content: "";
  position: fixed;
  inset: 0;
  pointer-events: none;
  z-index: -1;
  opacity: var(--app-shell-texture-opacity, 0.08);
  background-image:
    radial-gradient(circle at 1px 1px, color-mix(in srgb, var(--sys-border-subtle) 45%, transparent) 1px, transparent 0),
    linear-gradient(120deg, transparent 0%, color-mix(in srgb, var(--sys-border-subtle) 24%, transparent) 45%, transparent 100%);
  background-size: 3px 3px, 100% 100%;
}

.app-shell-topbar {
  background: var(--app-shell-topbar-bg, color-mix(in srgb, var(--sys-surface-panel) 82%, transparent)) !important;
  border-bottom-color: color-mix(in srgb, var(--sys-border-default) 86%, transparent) !important;
  box-shadow: 0 12px 30px color-mix(in srgb, #000 12%, transparent);
}

.app-shell-sidebar {
  background:
    linear-gradient(180deg, color-mix(in srgb, var(--sys-surface-panel) 98%, transparent), color-mix(in srgb, var(--sys-surface-panel) 93%, var(--sys-interactive-accent) 7%));
}

.app-shell-sidebar .MuiListItemButton-root.active {
  background: color-mix(in srgb, var(--sys-interactive-accent) 22%, transparent) !important;
  border-color: color-mix(in srgb, var(--sys-interactive-accent) 50%, var(--sys-border-default)) !important;
  box-shadow:
    inset 3px 0 0 var(--sys-interactive-accent),
    0 8px 20px color-mix(in srgb, var(--sys-interactive-accent) 16%, transparent);
}

.app-shell-sidebar .MuiListItemButton-root.active .MuiListItemIcon-root {
  color: var(--sys-interactive-accent);
}

.app-page-surface {
  position: relative;
  --route-frame-max-width: 1200px;
}

.app-page-surface::before {
  content: "";
  position: absolute;
  inset: 0;
  pointer-events: none;
  background:
    linear-gradient(180deg, color-mix(in srgb, var(--sys-surface-elevated) 28%, transparent) 0%, transparent 22%),
    radial-gradient(1200px circle at 70% 0%, color-mix(in srgb, var(--sys-interactive-accent) 8%, transparent), transparent 60%);
  opacity: var(--app-shell-page-overlay-opacity, 0.45);
  z-index: -1;
}

.app-route-frame {
  max-width: var(--route-frame-max-width);
  margin-inline: auto;
}

/* ============================================
   FILTER BAR EXPERIENCE
   ============================================ */
.app-page-surface .page-filter-bar {
  position: sticky;
  top: 0.75rem;
  z-index: 30;
  border-color: color-mix(in srgb, var(--sys-border-default) 75%, transparent);
  box-shadow:
    0 10px 30px color-mix(in srgb, #000 10%, transparent),
    inset 0 1px 0 color-mix(in srgb, #fff 18%, transparent);
}

.app-page-surface .page-filter-bar::before {
  content: "";
  position: absolute;
  inset: 0 0 auto 0;
  height: 2px;
  border-radius: inherit;
  background: linear-gradient(
    90deg,
    transparent 0%,
    color-mix(in srgb, var(--sys-interactive-accent) 70%, transparent) 30%,
    color-mix(in srgb, var(--sys-interactive-accent) 25%, transparent) 80%,
    transparent 100%
  );
  pointer-events: none;
}

.page-filter-bar[data-active-filters="true"] {
  border-color: color-mix(in srgb, var(--sys-interactive-accent) 40%, var(--sys-border-default));
}

.page-filter-bar .filter-category-pill[data-active="true"] {
  box-shadow:
    0 0 0 1px color-mix(in srgb, var(--sys-interactive-accent) 40%, transparent),
    0 8px 20px color-mix(in srgb, var(--sys-interactive-accent) 20%, transparent);
}

.page-filter-bar .page-filter-meta {
  border-top: 1px dashed color-mix(in srgb, var(--sys-border-default) 45%, transparent);
  padding-top: 0.45rem;
}

/* ============================================
   MUI SURFACE TOKEN BRIDGE
   ============================================ */
.app-page-surface .MuiCard-root,
.app-page-surface .MuiPaper-root[data-ui="card"],
.app-page-surface .MuiPaper-root.ui-card {
  background: var(--cmp-card-bg);
  border-color: var(--cmp-card-border);
  border-radius: var(--cmp-card-radius);
  box-shadow: var(--cmp-card-shadow);
  transition:
    box-shadow var(--theme-motion-medium, 240ms) var(--theme-motion-easing, ease),
    border-color var(--theme-motion-fast, 160ms) var(--theme-motion-easing, ease),
    transform var(--theme-motion-fast, 160ms) var(--theme-motion-easing, ease);
}

.app-page-surface .MuiCard-root:hover,
.app-page-surface .MuiPaper-root[data-ui="card"]:hover,
.app-page-surface .MuiPaper-root.ui-card:hover {
  border-color: color-mix(in srgb, var(--cmp-card-border) 72%, var(--sys-interactive-accent));
  box-shadow: var(--cmp-card-hover-shadow, var(--cmp-card-shadow));
}

@media (max-width: 900px) {
  .app-page-surface .page-filter-bar {
    top: 0.5rem;
  }
}

/* ============================================
   ACCESSIBILITY IMPROVEMENTS
   ============================================ */
/* Skip to main content link */
.skip-to-main {
  position: absolute;
  left: -9999px;
  z-index: 999;
  padding: 1em;
  background-color: var(--sys-surface-panel);
  color: var(--sys-text-primary);
  text-decoration: none;
  border-radius: var(--cmp-button-radius);
}

.skip-to-main:focus {
  left: 50%;
  transform: translateX(-50%);
  top: 1em;
}

/* Screen reader only text */
.sr-only {
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  white-space: nowrap;
  border-width: 0;
}

/* Reduced motion preferences */
@media (prefers-reduced-motion: reduce) {
  *,
  *::before,
  *::after {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
  }

  .skeleton,
  [data-loading="true"] {
    animation: none;
  }
}

/* High contrast mode support */
@media (prefers-contrast: high) {
  * {
    border-width: 2px;
  }

  button,
  input,
  select,
  textarea {
    border-width: 2px;
  }
}
